<!doctype html>
<html lang="us">
<head>
	<meta charset="utf-8">
	<title>jQuery UI Example Page</title>
	<link href="jquery-ui.css" rel="stylesheet">
	<style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            overflow: hidden;
        }
        .card {
            position: absolute;
            width: 150px;
            height: 100px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            user-select: none;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="card" style="left: 50px; top: 50px;">Carte 1</div>
    <div class="card" style="left: 250px; top: 50px;">Carte 2</div>
    <div class="card" style="left: 50px; top: 200px;">Carte 3</div>
    <div class="card" style="left: 250px; top: 200px;">Carte 4</div>



<script src="external/jquery/jquery.js"></script>
<script src="jquery-ui.js"></script>
<script>
        $(function() {
            function checkOverlap($elem1, $elem2) {
                var rect1 = $elem1[0].getBoundingClientRect();
                var rect2 = $elem2[0].getBoundingClientRect();
                return !(rect1.right < rect2.left || 
                         rect1.left > rect2.right || 
                         rect1.bottom < rect2.top || 
                         rect1.top > rect2.bottom);
            }

            $(".card").each(function(index) {
                var $card = $(this);
                var originalPosition = $card.position();
                var originalSize = { width: $card.width(), height: $card.height() };

                $card.data('originalPosition', originalPosition)
                     .data('originalSize', originalSize);

                console.log('Card ' + (index + 1) + ' initialized');

                $card.draggable({
                    containment: "window",
                    cursor: "move",
                    grid: [ 5, 5 ],
                    start: function(event, ui) {
                        $card.data('originalPosition', $card.position());
                        console.log('Card ' + (index + 1) + ' drag started');
                    },
                    stop: function(event, ui) {
                        if ($card.data('dropped')) {
                            console.log('Card ' + (index + 1) + ' drag cancelled due to overlap');
                            $card.animate($card.data('originalPosition'), 'fast');
                            $card.data('dropped', false);
                        } else {
                            console.log('Card ' + (index + 1) + ' drag completed');
                        }
                    },
                    refreshPositions: true
                }).resizable({
                    minHeight: 50,
                    minWidth: 100,
                    handles: "se",
                    grid: [ 5, 5 ],
                    start: function(event, ui) {
                        $card.data('originalSize', { width: ui.originalSize.width, height: ui.originalSize.height });
                        console.log('Card ' + (index + 1) + ' resize started');
                    },
                    resize: function(event, ui) {
                        console.log('Card ' + (index + 1) + ' resizing to ' + ui.size.width + 'x' + ui.size.height);
                        var isOverlapping = false;
                        $(".card").not($card).each(function() {
                            if (checkOverlap($card, $(this))) {
                                isOverlapping = true;
                                return false; // break the loop
                            }
                        });
                        if (isOverlapping) {
                            console.log('Card ' + (index + 1) + ' resize overlap detected');
                            $card.data('resizeDropped', true);
                            return false; // cancel resize
                        }
                    },
                    stop: function(event, ui) {
                        if ($card.data('resizeDropped')) {
                            console.log('Card ' + (index + 1) + ' resize cancelled due to overlap');
                            $card.animate({
                                width: $card.data('originalSize').width,
                                height: $card.data('originalSize').height
                            }, 'fast');
                            $card.data('resizeDropped', false);
                        } else {
                            console.log('Card ' + (index + 1) + ' resize completed to ' + ui.size.width + 'x' + ui.size.height);
                            $card.data('originalSize', { width: ui.size.width, height: ui.size.height });
                        }
                    },
                    refreshPositions: true
                }).droppable({
                    accept: ".card",
                    tolerance: "touch",
                    drop: function(event, ui) {
                        console.log('Card ' + (ui.draggable.index('.card') + 1) + ' detected drag overlap with Card ' + (index + 1));
                        ui.draggable.data('dropped', true);
                    }
                });
            });
        });
    </script>
</body>
</html>
